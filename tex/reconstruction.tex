\chapter{Kinematic Reconstruction}
\label{sec:reconstruction}

As discussed in Sec.~\ref{sec:genstrategy}, the \ac{} measurement relies on
the event--by--event reconstruction of the four--momenta of the
\ttbar{} pair. Inferring the four--momenta from the
reconstructed objects presents several challenges such as the
association of jets with
the partons from which they originated, the reconstruction of the
four--momentum of the neutrino from the missing transverse momentum,
and the pairing of $b$--jets with the decay products of the correct $W$
boson to form the top quark. The task is further complicated by the
presence of additional jets from initial and final state radiation and
by the large uncertainty on the jet energy determination. 
This section describes a likelihood fit procedure that exploits
several experimental quantities and kinematic constraints to associate
the reconstructed objects to the final state particles of the
semi--leptonic \ttbar{} decay and obtain an estimation of the
four--momenta of the top quark and antiquark. 

\section{Kinematic fit}

A maximum likelihood approach~\cite{klfitter} is used to determine the
four-momenta of the top and of the antitop quarks from the four-momenta of
the reconstructed decay products: at least four reconstructed jets, one lepton, and the
missing transverse momentum. The kinematic likelihood fit finds the
most likely association between reconstructed objects and \ttbar{} final state particles:
two $b$ quarks, two light quarks, one lepton and one neutrino.
The free parameters of the likelihood are the parton energies, the
lepton transverse momentum and the three neutrino momentum components.
For a given jet--parton association, the likelihood is defined as
\begin{eqnarray}
L & = & \mathcal{B}(\hat{p}_{q_1}, \hat{p}_{q_2} | m_W,  \Gamma_W)
      \cdot \mathcal{B}(\hat{p}_{\ell}, \hat{p}_{\nu} | m_W, \Gamma_W) \cdot \nonumber \\
           &   & \mathcal{B}(\hat{p}_{q_1}, \hat{p}_{q_2},\hat{p}_{q_3} | m_t, \Gamma_t)
                 \cdot \mathcal{B}(\hat{p}_{\ell}, \hat{p}_{\nu},\hat{p}_{q_4} | m_t, \Gamma_t) \cdot \nonumber \\
           &   & \mathcal{W}( \widetilde{E}_{x}^{Miss}| \hat{p}_{x, \nu})
                 \cdot \mathcal{W}(\widetilde{E}_{y}^{Miss} |    \hat{p}_{y, \nu})
                 \cdot \mathcal{W}(\widetilde{E}_{\ell} | \hat{E}_{\ell}) \cdot \nonumber \\
           &   & \prod_{i=1}^4 \mathcal{W}(\widetilde{E}_{jet_i} | \hat{E}_{q_i})
                 \cdot P(\textrm{$b$ tag} ~| ~\textrm{flavor}),
\label{eq:klflikelihood}
\end{eqnarray}
where:
\begin{itemize}
\item the $\hat{p}$ and $\hat{E}$ are the four--momenta and energies
  of the final state particles to be estimated, and
  $\widetilde{\square{}}$ are the measured values; 
\item $\mathcal{B}(\hat{p}|m,\Gamma)\propto((\hat{p}^2-m^2)^2+m^2\Gamma^2)^{-1}$ is
  the Breit-Wigner parametrization of the four--momenta of the quarks
  $\hat{p}_{p_i}$, the lepton $\hat{p}_{\ell}$ and the neutrino
  $\hat{p}_{\nu}$, in the $W$ boson and top quark decays.
\item $\mathcal{W}$s are probability densities, referred to as {\it
    transfer functions}, mapping the measured energy of a
  reconstructed object to the energy of the corresponding final state
  particle. They are measured on a sample of simulated \ttbar{} events.
\item The mass and width of the $W$ boson and of the top quark are set
  to their measured values $m_W = 80.4~\GeV{}$, $\Gamma_W = 2.1~\GeV{}$, $m_t =
       172.5~\GeV{}$, and $\Gamma_t = 1.5~\GeV{}$. 
\item The term $P(b-\textrm{tag} ~| ~\textrm{quark flavor})$ is used
  to weight the jet--parton association based on $b$--tagging
  information, and it is described in the following.
\end{itemize}

The likelihood is evaluated for all permutations of four reconstructed
jets assigned to the four partons.
In events where five or more jets were reconstructed, only a maximum
of five jets are considered. In the analysis at \seventev{} the five
highest--\pt{} jets are used, while, in the analysis at \eighttev{}, the two jets with
the highest $b$--tagging weight are always considered, in order to ensure
a better reconstruction in the sample with at least two $b$--jets. The
three remaining jets selected in \pt{}--order.
Out of all the possible permutations, the combination giving the
highest likelihood, after maximization over the free parameters, is chosen.
The role of the probability term $P(b-\textrm{tag} ~|
~\textrm{quark flavor})$ is to favor the association of $b$--jets with
the $b$ quarks from the top quark decays. The probability is defined,
for a given permutation of four jets, as the product of $b$-tag
efficiencies $\epsilon_b$ or mis--tag rates $\epsilon_{light}$ of each
jet $j$, based on the $b$--tagging decision and the flavor of the
associated quark:
\begin{equation}
P(b-\textrm{tag}~|~\textrm{quark flavor}) = \prod_{j}
\begin{cases}
\epsilon_b~\text{\small{if tagged jet associated with $b$ quark}}\\
(1-\epsilon_b)~\text{\small{if non-tagged jet associated with $b$ quark}} \\
\epsilon_{light}~\text{\small{if tagged jet associated with quark from
  $W$ boson}} \\
(1-\epsilon_{light})~\text{\small{if non-tagged jet associated with quark from
  $W$ boson}} \\
\end{cases}
\end{equation}
The average values for $\epsilon_b$ and $\epsilon_{light}$ are $70\%$
and $0.8\%$ respectively, even though they mildly depend on
jet \pt{} and $\eta$. 

The transfer functions $\mathcal{W}(E_{reco}|E_{truth})$ describe the probability that the
reconstructed energy $E_{reco}$ corresponds to a true value
$E_{truth}$.
The transfer functions are parametrized as double gaussians
\begin{equation}
  \label{eq:doublegaus}
  \mathcal{W}(E_\mathrm{reco}|E_\mathrm{truth}) = \frac{1}{\sqrt{2\pi}(p_2+p_3p_5)}\Bigg[ \exp\Bigg(-\frac{(\Delta E - p_1)^2}{2p_2^2}\Bigg) + p_3\exp\Bigg(-\frac{(\Delta E - p_4)^2}\
  {2p_5^2}\Bigg) \Bigg],
\end{equation}
where $\Delta E = (E_{truth}-E_{reco})/E_{truth}$, and the $p_i$
free parameters are estimated in different regions of $E_{truth}$ and
$\eta$ for each particle. Figure~\ref{fig:transferfunctions} show, as
example, the transfer functions for electrons and for $b$ quarks.

\begin{figure}[!htb]\centering
  \includegraphics[width=0.495\textwidth]{figures/reconstruction/eletf}
  \includegraphics[width=0.495\textwidth]{figures/reconstruction/btf}
  \caption[Energy evolution of transfer functions]{
    Energy evolution of the transfer functions for electrons in the
    range $0.8<\eta<1.37$ (left) and for $b$ quarks in the range
    $0<\eta<0.8$ (right). 
    \label{fig:transferfunctions}
    }
\end{figure}

\section{Performance}

Due to selection, resolution and combinatorics effects, the efficiency
of reconstructing a \ttbar{} pair matching\footnote{A reconstructed
  object $i$ is considered matched with a parton $j$ if the condition
  $\deltaR{i}{j}<0.2$ is satisfied.} the original top quark and antiquark is
$25\%$. The dominant cause of mis--reconstruction is the wrong jet
assignment to the corresponding \ttbar{} final state parton. This
typically occurs in three cases:
\begin{itemize}
\item {\it jets outside acceptance}: the jet originating from a given
  parton does not satisfy the reconstruction requirements, such as
  $\pt{}>25 \GeV$ or pseudo--rapidity within the $|\eta|<2.5$ range.
  The fraction of events where all \ttbar{} final state partons are
  reconstructed as jets is $25$ and $40\%$, for the samples with 1 and
  at least 2 $b$--jets, respectively.
\item {\it jets outside selection}: given that up to five jets are
  considered, in events with more
  than five jets, some of the jets corresponding to
  the \ttbar{} decay are not used in the reconstruction algorithm.
  While events with high jet multiplicity are rare, for those events,
  and with all matched jets being within acceptance,
  this occurs approximately $50\%$ of the times. 
\item {\it jets mis-assigned}: one or more jets are not assigned to
  the correct parton. It occurs about $15-25\%$ of the times for
  events where the correct jets were used in the reconstruction
  algorithm, depending on the $b$--jet multiplicity requirement.
\end{itemize}

The impact of mis--reconstruction is reflected on the resolution of
the kinematic quantities of the reconstructed
\ttbar. Fig.~\ref{fig:reso} show two dimensional distributions of
the reconstructed quantities in relation to their true values. The
resolution on \mtt{} and \pttt{} improves at higher values, while the
top rapidity shows a small spread over the whole range.

\begin{figure}[!htb]\centering
  \includegraphics[width=0.495\textwidth]{figures/reconstruction/mtt}
  \includegraphics[width=0.495\textwidth]{figures/reconstruction/pttt}
  \includegraphics[width=0.495\textwidth]{figures/reconstruction/betatt}
  \includegraphics[width=0.495\textwidth]{figures/reconstruction/topy}
  \caption{
    \label{fig:reso}
    Distributions of kinematic quantities of the
    reconstructed \ttbar{} pair in relation to their true values.
  }
\end{figure} 

For what concerns the asymmetry measurement, the relevant benchmark of
the reconstruction performance is the efficiency of reconstructing
correctly the \dy{} sign, defined as
\begin{equation}
  \label{eq:dysign}
  \epsilon = \frac{N(\dy{}_{truth}\cdot\dy{}_{reco}>0)}{N_{tot}}.
\end{equation}
Events where the \dy{} sign is measured incorrectly can occur when the top and
antitop quarks are not reconstructed from the correct final
state particles (mis-reconstruction). Even when the reconstruction
algorithm associates the correct particles, small \dy{} values can be
reconstructed with the wrong sign due to resolution effects.
The efficiency $\epsilon$ depends on the kinematic region
considered. As shown in Fig.~\ref{fig:dysign}, the \dy{} reconstruction performs
better at high \mtt{}, where the \ttbar{} pair is produced with a wide
opening angle and large momentum. At $\mtt{}\geq1\TeV{}$, the efficiency
starts to degrade as some of the top quark decay products cannot be
resolved due to the large top quark boost.

\begin{figure}[!htb]\centering
  \includegraphics[width=0.495\textwidth]{figures/reconstruction/signdy_eff}
  \caption{
    \label{fig:dysign}
    Probability to reconstruct the correct \dy{} sign as a funcion of
    the \ttbar{} invariant mass \mtt{} in the sample with 1 $b$--jet
    (red dots) and with at least 2 $b$--jets (blue squares).
  }
\end{figure}

The integrated efficiency $\epsilon$, measured in the \ttbar{} simulated sample,
is about $72\%$ in the sample with 1 $b$--jet and about $75\%$ in the
sample with at least 2 $b$--jets. As a consequence, the inclusive
asymmetry of the distribution of reconstructed \dy{} is reduced by a factor 
\begin{equation}
  \label{eq:dilution}
D = 2\times{}\epsilon - 1=2\times0.75-1=0.5
\end{equation}
relative to its true (parton--level) value. The factor $D$ is commonly
know as {\it dilution}.
Table~\ref{tab:actruthreco} shows the evolution of the asymmetry
values due to selection and reconstruction effects. 

\begin{table}[!htb]\centering
  \begin{tabular}{ c c c}
    \toprule
    true \ac{} & true \ac{} after selection & reconstructed \ac{}\\
    \midrule
    0.57\% & 0.36\% &  0.25\%  \\
    \bottomrule
  \end{tabular}
  \caption{\ac{} values in the simulated \ttbar{} sample at truth and
    reconstructed level.}
  \label{tab:actruthreco}
\end{table}

\section{Comparison between data and prediction}
\label{sec:datamcreco}

The modeling of the reconstructed quantities is validated by comparing
the distributions as observed in data with the prediction. 
Figure~\ref{fig:datamcreco2011} and ~\ref{fig:datamcreco2012}
shows the comparison of the distributions of
the top quark pair invariant mass \mtt{}, transverse momentum \pttt{},
rapidity \ytt{}, and velocity along the beam axis \betatt{} for the
datasets at \seventev{} and \eighttev{}, respectively.
%                                   
\begin{figure}[!htb]\centering
  \includegraphics[width=0.495\textwidth]{figures/reconstruction/7TeV/dy}
  \includegraphics[width=0.495\textwidth]{figures/reconstruction/7TeV/mtt}
  \includegraphics[width=0.495\textwidth]{figures/reconstruction/7TeV/pttt}
  \includegraphics[width=0.495\textwidth]{figures/reconstruction/7TeV/ytt}
  \includegraphics[width=0.495\textwidth]{figures/reconstruction/7TeV/betatt}
  \caption{Comparison between data and prediction for \dy{} (top
    left), invariant mass \mtt{} (top right), transverse momentum
    \pttt{} (centre left), absolute rapidity $|\ytt{}|$ (centre right)
    and velocity \betatt{} (bottom) distributions for the \ejets{} and
    \mujets{} channels combined in the tagged sample at
    \seventev{}. The uncertainty on the total prediction includes both
    the statistical and the systematic components.} 
  \label{fig:datamcreco2011}
\end{figure}
%
\begin{figure}[!htb]\centering
  \includegraphics[width=0.495\textwidth]{figures/reconstruction/8TeV/1tagex/topy}
  \includegraphics[width=0.495\textwidth]{figures/reconstruction/8TeV/1tagex/pttt}
  \includegraphics[width=0.495\textwidth]{figures/reconstruction/8TeV/2tagin/dy}
  \includegraphics[width=0.495\textwidth]{figures/reconstruction/8TeV/2tagin/mtt}
  \caption{Comparison between distributions of kinematic quantities in
    data and prediction for the \ejets{} and \mujets{} channels
    combined at \eighttev{}. Top: top quark rapidity $y$ (left) and
    transverse momentum \pttt{} (right) in the sample with 1 $b$--jet.
    Bottom: rapidity difference \dy{} (left) and invariant mass \mtt{}
    (right) in the sample with at least 2 $b$--jets.
    The sample composition is calibrated to data (see
    Sec.~\ref{sec:marginalization}), and the corresponding normalization
    uncertainty is shown.} 
  \label{fig:datamcreco2012}
\end{figure}
%

For the differential measurements at \seventev{}, a
requirement on reconstruction quality is applied to improve the
resolution on reconstructed quantities.
A 20\% reduction on the \ac{} uncertainty in the highest mass bin
($\mtt{}>750\GeV{}$) is achieved by requiring the logarithm of the
likelihood ($\log (L)$) to be $>-55$, as shown in Figure~\ref{fig:errvsllcut}.
\begin{figure}[!htb]\centering
  \includegraphics[width=0.495\textwidth]{figures/reconstruction/asymm5errVsLLcut}
  \includegraphics[width=0.495\textwidth]{figures/reconstruction/hll_muonele_7tev}
  \caption{
    \label{fig:errvsllcut}
    Evolution of the statistical uncertainty on \ac{} for
    $\mtt{}>750\GeV{}$ as a function of the minimum requirement on
    $\log (L)$ (left) and comparison of the log(L) distribution in data
    and prediction (right) for the combined \ljets{} channel.
  }
\end{figure}
The modeling of the log-likelihood is validated by comparing its
distribution in data with the prediction.
In the analysis at \eighttev{}, no reconstruction quality requirement
has been applied at this stage. The study and definition of such
requirements might help reducing the statistical uncertainty in the
differential measurements, as in the case of the \seventev{} analysis.
